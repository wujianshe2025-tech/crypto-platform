<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿½é£è§‚æµ‹ - åŠ å¯†è´§å¸è¡Œæƒ…ä¸é¢„æµ‹å¹³å°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <nav class="bg-gray-800 border-b border-gray-700">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-8">
                    <div class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text" style="background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ğŸŒªï¸ è¿½é£è§‚æµ‹</div>
                    <div class="flex space-x-1">
                        <button onclick="showPage('market')" class="nav-btn px-4 py-2 rounded hover:bg-gray-700">ğŸ“Š è¡Œæƒ…</button>
                        <button onclick="showPage('news')" class="nav-btn px-4 py-2 rounded hover:bg-gray-700">ğŸ“° æ–°é—»</button>
                        <button onclick="showPage('calendar')" class="nav-btn px-4 py-2 rounded hover:bg-gray-700">ğŸ“… æ•°æ®æ—¥å†</button>
                        <button onclick="showPage('community')" class="nav-btn px-4 py-2 rounded hover:bg-gray-700">ğŸ’¬ ç¤¾åŒº</button>
                        <button onclick="showPage('predictions')" class="nav-btn px-4 py-2 rounded hover:bg-gray-700">ğŸ¯ é¢„æµ‹</button>
                    </div>
                </div>
                <div class="text-sm text-gray-400">çœŸå®æ•°æ®ç‰ˆ</div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
        <!-- è¡Œæƒ…é¡µé¢ -->
        <div id="market-page" class="page">
            <div class="flex items-center justify-between mb-8">
                <h1 class="text-3xl font-bold">å®æ—¶è¡Œæƒ…</h1>
                <div class="flex items-center space-x-2 text-sm text-gray-400">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                    <span>å®æ—¶æ›´æ–°ä¸­</span>
                </div>
            </div>
            <div class="bg-gray-800 rounded-lg overflow-hidden shadow-xl">
                <table class="w-full">
                    <thead class="bg-gradient-to-r from-gray-700 to-gray-800">
                        <tr>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-300">å¸ç§</th>
                            <th class="px-6 py-4 text-right text-sm font-semibold text-gray-300">æœ€æ–°ä»·æ ¼</th>
                            <th class="px-6 py-4 text-right text-sm font-semibold text-gray-300">24hæ¶¨è·Œ</th>
                            <th class="px-6 py-4 text-right text-sm font-semibold text-gray-300">å¸‚å€¼</th>
                            <th class="px-6 py-4 text-right text-sm font-semibold text-gray-300">æˆäº¤é‡</th>
                            <th class="px-6 py-4 text-right text-sm font-semibold text-gray-300">24hæœ€é«˜/æœ€ä½</th>
                        </tr>
                    </thead>
                    <tbody id="crypto-table"></tbody>
                </table>
            </div>
            <div class="mt-6 p-4 bg-green-900/20 border border-green-500/30 rounded-lg">
                <p class="text-sm text-green-300">âœ… <strong>çœŸå®æ•°æ®ï¼š</strong>ä»·æ ¼æ•°æ®æ¥è‡ª CoinGecko APIï¼Œæ¯30ç§’è‡ªåŠ¨æ›´æ–°</p>
            </div>
        </div>

        <!-- æ–°é—»é¡µé¢ -->
        <div id="news-page" class="page hidden">
            <div class="flex items-center justify-between mb-8">
                <h1 class="text-3xl font-bold">æ–°é—»èµ„è®¯</h1>
                <div class="flex space-x-2">
                    <button onclick="filterNews('')" class="filter-btn px-4 py-2 rounded bg-blue-600">å…¨éƒ¨</button>
                    <button onclick="filterNews('realtime')" class="filter-btn px-4 py-2 rounded bg-gray-700 hover:bg-gray-600">å®æ—¶æ–°é—»</button>
                    <button onclick="filterNews('important')" class="filter-btn px-4 py-2 rounded bg-gray-700 hover:bg-gray-600">é‡è¦äº‹ä»¶</button>
                    <button onclick="filterNews('breaking')" class="filter-btn px-4 py-2 rounded bg-gray-700 hover:bg-gray-600">çªå‘äº‹ä»¶</button>
                </div>
            </div>
            <div id="news-list" class="space-y-4"></div>
        </div>

        <!-- æ•°æ®æ—¥å†é¡µé¢ -->
        <div id="calendar-page" class="page hidden">
            <h1 class="text-3xl font-bold mb-8">ğŸ“… ç»æµæ•°æ®æ—¥å†</h1>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- æœ¬å‘¨æ•°æ® -->
                <div class="bg-gray-800 rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="text-blue-400 mr-2">ğŸ“Š</span> æœ¬å‘¨é‡è¦æ•°æ®
                    </h2>
                    <div id="week-data" class="space-y-3"></div>
                </div>
                
                <!-- ä¸‹å‘¨æ•°æ® -->
                <div class="bg-gray-800 rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="text-purple-400 mr-2">ğŸ“ˆ</span> ä¸‹å‘¨å¾…å…¬å¸ƒ
                    </h2>
                    <div id="next-week-data" class="space-y-3"></div>
                </div>
            </div>
            
            <!-- æœˆåº¦æ—¥å† -->
            <div class="mt-8 bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4">æœ¬æœˆæ•°æ®æ—¥å†</h2>
                <div id="calendar-grid" class="grid grid-cols-7 gap-2"></div>
            </div>
        </div>

        <!-- ç¤¾åŒºé¡µé¢ -->
        <div id="community-page" class="page hidden">
            <h1 class="text-3xl font-bold mb-8">ç¤¾åŒºè®ºå›</h1>
            <div class="bg-gray-800 rounded-lg p-6 mb-8">
                <textarea id="new-post" placeholder="åˆ†äº«ä½ çš„è§‚ç‚¹..." class="w-full bg-gray-700 rounded-lg p-4 text-white resize-none" rows="4"></textarea>
                <div class="flex justify-end mt-4">
                    <button onclick="createPost()" class="px-6 py-2 bg-blue-600 rounded-lg hover:bg-blue-700">å‘å¸ƒ</button>
                </div>
            </div>
            <div id="posts-list" class="space-y-6"></div>
        </div>

        <!-- é¢„æµ‹é¡µé¢ -->
        <div id="predictions-page" class="page hidden">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h1 class="text-3xl font-bold mb-2">é¢„æµ‹æŠ•ç¥¨</h1>
                    <p class="text-gray-400 text-sm">å‚ä¸é¢„æµ‹ï¼Œèµ¢å–å¥–åŠ± ğŸ¯</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="member-status" class="text-sm">
                        ${isMember ? 
                            '<span class="px-4 py-2 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg font-semibold">ğŸ‘‘ ä¼šå‘˜</span>' : 
                            '<button onclick="showMembershipModal()" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg hover:from-blue-700 hover:to-purple-700 font-semibold">æˆä¸ºä¼šå‘˜</button>'
                        }
                    </div>
                    <button onclick="toggleCreatePrediction()" class="px-6 py-2 bg-gradient-to-r from-green-600 to-teal-600 rounded-lg hover:from-green-700 hover:to-teal-700 font-semibold shadow-lg">+ å‘èµ·é¢„æµ‹</button>
                </div>
            </div>
            
            <!-- ä¼šå‘˜æç¤º -->
            <div id="member-notice" class="bg-gradient-to-r from-yellow-900/30 to-orange-900/30 border border-yellow-500/50 rounded-lg p-4 mb-6">
                <div class="flex items-center space-x-3">
                    <span class="text-3xl">ğŸ‘‘</span>
                    <div class="flex-1">
                        <div class="font-semibold text-yellow-400 mb-1">ä¼šå‘˜ä¸“äº«åŠŸèƒ½</div>
                        <div class="text-sm text-gray-300">ä»…éœ€ 1 USDT å³å¯æˆä¸ºä¼šå‘˜ï¼Œè§£é”å‘èµ·é¢„æµ‹å’Œå‚ä¸æŠ•ç¥¨åŠŸèƒ½ï¼Œé¢„æµ‹å‡†ç¡®è¿˜èƒ½è·å¾—åŠ å¯†è´§å¸å¥–åŠ±ï¼</div>
                    </div>
                </div>
            </div>

            <!-- å¹³å°æ¿€åŠ±åŸºé‡‘ -->
            <div class="bg-gradient-to-r from-purple-900/30 to-blue-900/30 border border-purple-500/50 rounded-lg p-4 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <span class="text-3xl">ğŸ†</span>
                        <div>
                            <div class="font-semibold text-purple-400 mb-1">å¹³å°æ¿€åŠ±åŸºé‡‘</div>
                            <div class="text-sm text-gray-300">æ¯å‘¨å‘æ”¾ç»™æ´»è·ƒè´¡çŒ®ç”¨æˆ·</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-purple-400" id="platform-fund">0 USDT</div>
                        <div class="text-xs text-gray-400">ä¸‹æ¬¡å‘æ”¾ï¼šå‘¨æ—¥</div>
                    </div>
                </div>
            </div>

            <div id="create-prediction" class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 mb-8 hidden border border-gray-700 shadow-xl">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="text-2xl mr-2">ğŸ¯</span> åˆ›å»ºæ–°é¢„æµ‹
                </h2>
                
                <!-- ä»Šæ—¥å‘èµ·ç»Ÿè®¡ -->
                <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-3 mb-4 text-sm">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-300">ä»Šæ—¥å·²å‘èµ·ï¼š</span>
                        <div class="flex items-center space-x-4">
                            <span class="text-green-400">æœ‰å¥– ${userStats.rewardPredictionsToday}/1</span>
                            <span class="text-blue-400">æ— å¥– ${userStats.freePredictionsToday}/10</span>
                        </div>
                    </div>
                </div>

                <input id="pred-title" type="text" placeholder="é¢„æµ‹æ ‡é¢˜" class="w-full bg-gray-700 rounded-lg p-3 text-white mb-4 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                <textarea id="pred-desc" placeholder="é¢„æµ‹æè¿°ï¼ˆå¯é€‰ï¼‰" class="w-full bg-gray-700 rounded-lg p-3 text-white resize-none mb-4 focus:ring-2 focus:ring-blue-500 focus:outline-none" rows="3"></textarea>
                
                <!-- å¥–é‡‘è®¾ç½® -->
                <div class="bg-gray-700 rounded-lg p-4 mb-4">
                    <div class="flex items-center justify-between mb-3">
                        <label class="font-semibold">é¢„æµ‹ç±»å‹</label>
                        <div class="flex items-center space-x-2">
                            <button id="reward-toggle" onclick="toggleRewardType()" class="px-4 py-2 bg-green-600 rounded-lg text-sm font-semibold">
                                ğŸ’° æœ‰å¥–é¢„æµ‹
                            </button>
                        </div>
                    </div>
                    
                    <div id="reward-settings" class="space-y-3">
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">æ¯äººæŠ•æ³¨é‡‘é¢ï¼ˆUSDTï¼‰</label>
                            <div class="flex space-x-2">
                                <button onclick="setRewardAmount(1)" class="reward-btn flex-1 px-4 py-2 bg-gray-600 rounded hover:bg-blue-600 transition">1</button>
                                <button onclick="setRewardAmount(2)" class="reward-btn flex-1 px-4 py-2 bg-blue-600 rounded hover:bg-blue-700 transition">2</button>
                                <button onclick="setRewardAmount(3)" class="reward-btn flex-1 px-4 py-2 bg-gray-600 rounded hover:bg-blue-600 transition">3</button>
                                <button onclick="setRewardAmount(4)" class="reward-btn flex-1 px-4 py-2 bg-gray-600 rounded hover:bg-blue-600 transition">4</button>
                                <button onclick="setRewardAmount(5)" class="reward-btn flex-1 px-4 py-2 bg-gray-600 rounded hover:bg-blue-600 transition">5</button>
                            </div>
                        </div>
                        
                        <div class="bg-gray-800 rounded p-3 text-xs space-y-1">
                            <div class="flex justify-between text-gray-400">
                                <span>å¥–é‡‘åˆ†é…è§„åˆ™ï¼š</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">â€¢ èƒœå‡ºæ–¹è·å¾—</span>
                                <span class="text-green-400 font-semibold">90%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">â€¢ å‘èµ·è€…è·å¾—</span>
                                <span class="text-yellow-400 font-semibold">1%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">â€¢ å¹³å°æ¿€åŠ±åŸºé‡‘</span>
                                <span class="text-blue-400 font-semibold">4%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">â€¢ å¹³å°è¿è¥è´¹</span>
                                <span class="text-purple-400 font-semibold">5%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-3">
                    <button onclick="createPrediction()" class="flex-1 px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg hover:from-blue-700 hover:to-purple-700 font-semibold shadow-lg">åˆ›å»ºé¢„æµ‹</button>
                    <button onclick="toggleCreatePrediction()" class="px-6 py-3 bg-gray-700 rounded-lg hover:bg-gray-600">å–æ¶ˆ</button>
                </div>
            </div>
            <div id="predictions-list" class="space-y-6"></div>
        </div>

        <!-- ä¼šå‘˜å¼¹çª— -->
        <div id="membership-modal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50" style="display: none;">
            <div class="bg-gray-800 rounded-xl p-8 max-w-md mx-4 shadow-2xl border border-gray-700">
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4">ğŸ‘‘</div>
                    <h2 class="text-2xl font-bold mb-2">æˆä¸ºä¼šå‘˜</h2>
                    <p class="text-gray-400">è§£é”å…¨éƒ¨åŠŸèƒ½ï¼Œå¼€å¯é¢„æµ‹ä¹‹æ—…</p>
                </div>
                
                <div class="bg-gradient-to-r from-yellow-900/30 to-orange-900/30 rounded-lg p-6 mb-6 border border-yellow-500/30">
                    <div class="text-center mb-4">
                        <div class="text-4xl font-bold text-yellow-400 mb-2">1 USDT</div>
                        <div class="text-sm text-gray-400">ä¸€æ¬¡æ€§ä»˜è´¹ï¼Œæ°¸ä¹…ä¼šå‘˜</div>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-center space-x-2">
                            <span class="text-green-400">âœ“</span>
                            <span>å‘èµ·é¢„æµ‹æŠ•ç¥¨</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-green-400">âœ“</span>
                            <span>å‚ä¸æ‰€æœ‰é¢„æµ‹</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-green-400">âœ“</span>
                            <span>é¢„æµ‹å‡†ç¡®è·å¾—å¥–åŠ±</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-green-400">âœ“</span>
                            <span>ä¸“å±ä¼šå‘˜æ ‡è¯†</span>
                        </div>
                    </div>
                </div>

                <button onclick="becomeMember()" class="w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg hover:from-yellow-600 hover:to-orange-600 font-semibold text-white shadow-lg mb-3">
                    ç«‹å³æ”¯ä»˜ 1 USDT
                </button>
                <button onclick="closeMembershipModal()" class="w-full px-6 py-3 bg-gray-700 rounded-lg hover:bg-gray-600">
                    ç¨åå†è¯´
                </button>
            </div>
        </div>
    </main>

    <script>
        // APIé…ç½®
        const COINGECKO_API = 'https://api.coingecko.com/api/v3';
        const CRYPTOCOMPARE_API = 'https://min-api.cryptocompare.com/data/v2';
        
        // æ•°æ®å­˜å‚¨
        let cryptoData = [];

        let economicData = [
            { id: 1, country: 'ğŸ‡ºğŸ‡¸ ç¾å›½', event: 'éå†œå°±ä¸šæ•°æ®', date: '12æœˆ8æ—¥', time: '21:30', importance: 5, status: 'upcoming', previous: '15ä¸‡', forecast: '18ä¸‡', actual: '' },
            { id: 2, country: 'ğŸ‡ºğŸ‡¸ ç¾å›½', event: 'CPIé€šèƒ€æ•°æ®', date: '12æœˆ12æ—¥', time: '21:30', importance: 5, status: 'upcoming', previous: '3.2%', forecast: '3.1%', actual: '' },
            { id: 3, country: 'ğŸ‡ºğŸ‡¸ ç¾å›½', event: 'è”å‚¨åˆ©ç‡å†³è®®', date: '12æœˆ14æ—¥', time: '03:00', importance: 5, status: 'upcoming', previous: '5.5%', forecast: '5.5%', actual: '' },
            { id: 4, country: 'ğŸ‡ªğŸ‡º æ¬§å…ƒåŒº', event: 'GDPæ•°æ®', date: '12æœˆ7æ—¥', time: '18:00', importance: 4, status: 'published', previous: '0.1%', forecast: '0.2%', actual: '0.1%' },
            { id: 5, country: 'ğŸ‡¨ğŸ‡³ ä¸­å›½', event: 'CPIæ•°æ®', date: '12æœˆ9æ—¥', time: '09:30', importance: 4, status: 'upcoming', previous: '0.2%', forecast: '0.3%', actual: '' },
            { id: 6, country: 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬', event: 'å¤®è¡Œåˆ©ç‡å†³è®®', date: '12æœˆ19æ—¥', time: '11:00', importance: 4, status: 'upcoming', previous: '-0.1%', forecast: '-0.1%', actual: '' },
            { id: 7, country: 'ğŸ‡¬ğŸ‡§ è‹±å›½', event: 'å¤±ä¸šç‡', date: '12æœˆ13æ—¥', time: '15:00', importance: 3, status: 'upcoming', previous: '4.2%', forecast: '4.3%', actual: '' },
            { id: 8, country: 'ğŸ‡¨ğŸ‡¦ åŠ æ‹¿å¤§', event: 'å°±ä¸šæ•°æ®', date: '12æœˆ8æ—¥', time: '21:30', importance: 3, status: 'upcoming', previous: '1.8ä¸‡', forecast: '2.0ä¸‡', actual: '' },
        ];

        let isLoggedIn = false;
        let isMember = false;
        
        // ç”¨æˆ·æ¯æ—¥å‘èµ·é™åˆ¶
        let userStats = {
            rewardPredictionsToday: 0,  // ä»Šå¤©å‘èµ·çš„æœ‰å¥–é¢„æµ‹æ•°
            freePredictionsToday: 0,     // ä»Šå¤©å‘èµ·çš„æ— å¥–é¢„æµ‹æ•°
            lastResetDate: new Date().toDateString(),  // ä¸Šæ¬¡é‡ç½®æ—¥æœŸ
            platformFund: 0,  // å¹³å°ç´¯è®¡æ¿€åŠ±åŸºé‡‘
            weeklyContributions: []  // æœ¬å‘¨è´¡çŒ®è®°å½•
        };

        let newsData = [];
        let currentNewsFilter = '';
        
        // ä¸­æ–‡å…³é”®è¯æ˜ å°„
        const translateKeywords = {
            'Bitcoin': 'æ¯”ç‰¹å¸', 'BTC': 'æ¯”ç‰¹å¸',
            'Ethereum': 'ä»¥å¤ªåŠ', 'ETH': 'ä»¥å¤ªåŠ',
            'cryptocurrency': 'åŠ å¯†è´§å¸', 'crypto': 'åŠ å¯†è´§å¸',
            'blockchain': 'åŒºå—é“¾', 'price': 'ä»·æ ¼',
            'market': 'å¸‚åœº', 'trading': 'äº¤æ˜“',
            'bull': 'ç‰›å¸‚', 'bear': 'ç†Šå¸‚',
            'surge': 'é£™å‡', 'crash': 'æš´è·Œ',
            'rally': 'åå¼¹', 'drop': 'ä¸‹è·Œ'
        };
        
        // ç¿»è¯‘å‡½æ•°
        function translateText(text) {
            let translated = text;
            for (const [en, cn] of Object.entries(translateKeywords)) {
                const regex = new RegExp(en, 'gi');
                translated = translated.replace(regex, cn);
            }
            return translated;
        }
        
        // åˆ†ææƒ…ç»ª
        function analyzeSentiment(text) {
            const bullish = ['surge', 'rally', 'bull', 'rise', 'gain', 'high', 'up', 'growth'];
            const bearish = ['crash', 'drop', 'bear', 'fall', 'decline', 'down', 'loss', 'low'];
            const lower = text.toLowerCase();
            const bullCount = bullish.filter(w => lower.includes(w)).length;
            const bearCount = bearish.filter(w => lower.includes(w)).length;
            return bullCount > bearCount ? 'bullish' : bearCount > bullCount ? 'bearish' : 'neutral';
        }
        
        // åŠ è½½çœŸå®æ–°é—»
        async function loadNews() {
            try {
                const response = await fetch(`${CRYPTOCOMPARE_API}/news/?lang=EN`);
                if (!response.ok) throw new Error('Failed to fetch');
                
                const data = await response.json();
                newsData = data.Data.slice(0, 20).map((news, i) => ({
                    id: news.id,
                    title: translateText(news.title),
                    content: translateText(news.body).substring(0, 150),
                    category: i < 3 ? 'breaking' : i < 8 ? 'important' : 'realtime',
                    sentiment: analyzeSentiment(news.title + ' ' + news.body),
                    source: news.source,
                    time: getTimeAgo(news.published_on),
                    views: Math.floor(Math.random() * 3000) + 500
                }));
                renderNews(currentNewsFilter);
            } catch (error) {
                console.error('Error loading news:', error);
            }
        }
        
        function getTimeAgo(timestamp) {
            const diff = Date.now() - timestamp * 1000;
            const hours = Math.floor(diff / 3600000);
            if (hours < 1) return 'åˆšåˆš';
            if (hours < 24) return `${hours}å°æ—¶å‰`;
            return `${Math.floor(hours / 24)}å¤©å‰`;
        }

        let posts = [
            { id: 1, user: 'åŠ å¯†è€éŸ­èœ', content: 'åˆšåˆšæŠ„åº•äº†ä¸€äº›ETHï¼Œæ„Ÿè§‰2300æ˜¯ä¸ªä¸é”™çš„å…¥åœºç‚¹ä½ã€‚å¤§å®¶æ€ä¹ˆçœ‹ï¼Ÿ', likes: 3, comments: 2, time: '1å°æ—¶å‰' },
            { id: 2, user: 'DeFiç©å®¶', content: 'æœ€è¿‘åœ¨ç ”ç©¶Solanaä¸Šçš„æ–°é¡¹ç›®ï¼Œæ”¶ç›Šç‡çœŸçš„å¾ˆé¦™ï¼', likes: 2, comments: 1, time: '2å°æ—¶å‰' },
        ];

        let predictions = [
            { 
                id: 1, 
                creator: 'é¢„æµ‹å¤§å¸ˆ', 
                title: 'BTCåœ¨2024å¹´1æœˆåº•èƒ½å¦çªç ´50000ç¾å…ƒï¼Ÿ', 
                desc: 'æ ¹æ®å½“å‰å¸‚åœºèµ°åŠ¿é¢„æµ‹', 
                options: [{text: 'èƒ½çªç ´', votes: 5}, {text: 'ä¸èƒ½çªç ´', votes: 2}], 
                hasReward: true,
                rewardPerPerson: 2,  // æ¯äºº2 USDT
                totalPool: 14,  // 7äººå‚ä¸ * 2 USDT
                creatorReward: 0.14,  // 1%
                platformFee: 0.56,  // 4%
                winnerPool: 12.6,  // 90%
                deadline: '30å¤©',
                status: 'active'
            },
            { 
                id: 2, 
                creator: 'å¸‚åœºè§‚å¯Ÿè€…', 
                title: 'ç¾è”å‚¨ä¸‹æ¬¡ä¼šè®®ä¼šé™æ¯å—ï¼Ÿ', 
                desc: 'é¢„æµ‹è´§å¸æ”¿ç­–å½±å“', 
                options: [{text: 'ä¼šé™æ¯', votes: 6}, {text: 'ç»´æŒä¸å˜', votes: 3}, {text: 'ä¼šåŠ æ¯', votes: 1}], 
                hasReward: true,
                rewardPerPerson: 3,  // æ¯äºº3 USDT
                totalPool: 30,  // 10äººå‚ä¸ * 3 USDT
                creatorReward: 0.3,  // 1%
                platformFee: 1.2,  // 4%
                winnerPool: 27,  // 90%
                deadline: '15å¤©',
                status: 'active'
            },
            { 
                id: 3, 
                creator: 'å¸åœˆåˆ†æå¸ˆ', 
                title: 'ETHæœ¬å‘¨èƒ½å¦çªç ´2500ç¾å…ƒï¼Ÿ', 
                desc: 'ä»¥å¤ªåŠæŠ€æœ¯é¢åˆ†æ', 
                options: [{text: 'èƒ½çªç ´', votes: 8}, {text: 'ä¸èƒ½çªç ´', votes: 4}], 
                hasReward: false,  // æ— å¥–é¢„æµ‹
                totalPool: 0,
                deadline: '7å¤©',
                status: 'active'
            },
        ];

        // é¡µé¢åˆ‡æ¢
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(page + '-page').classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('bg-blue-600'));
            event.target.classList.add('bg-blue-600');
            
            // åˆ‡æ¢åˆ°æ–°é—»é¡µé¢æ—¶åŠ è½½æ•°æ®
            if (page === 'news' && newsData.length === 0) {
                loadNews();
            }
        }

        // åŠ è½½çœŸå®åŠ å¯†è´§å¸æ•°æ®
        async function loadCryptoPrices() {
            try {
                const response = await fetch(
                    `${COINGECKO_API}/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false&price_change_percentage=24h`
                );
                
                if (!response.ok) throw new Error('Failed to fetch');
                
                const data = await response.json();
                cryptoData = data.map(coin => ({
                    id: coin.id,
                    symbol: coin.symbol.toUpperCase(),
                    name: coin.name,
                    price: coin.current_price,
                    change: coin.price_change_percentage_24h,
                    marketCap: coin.market_cap / 1e9,
                    volume: coin.total_volume / 1e9,
                    high24h: coin.high_24h,
                    low24h: coin.low_24h
                }));
                renderCrypto();
            } catch (error) {
                console.error('Error loading crypto prices:', error);
            }
        }

        // æ¸²æŸ“è¡Œæƒ…è¡¨æ ¼
        function renderCrypto() {
            const tbody = document.getElementById('crypto-table');
            tbody.innerHTML = cryptoData.map((coin, i) => `
                <tr class="border-t border-gray-700 hover:bg-gray-750 transition cursor-pointer">
                    <td class="px-6 py-4">
                        <div class="flex items-center space-x-3">
                            <span class="text-gray-400 font-medium">#${i+1}</span>
                            <div class="w-8 h-8 rounded-full bg-gradient-to-br ${getGradient(coin.symbol)} flex items-center justify-center text-white font-bold text-sm">
                                ${coin.symbol[0]}
                            </div>
                            <div>
                                <div class="font-semibold">${coin.name}</div>
                                <div class="text-xs text-gray-400">${coin.symbol}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <div class="font-mono font-semibold text-lg">$${coin.price.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                        <div class="text-xs text-gray-400">â‰ˆ Â¥${(coin.price * 7.2).toFixed(2)}</div>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <div class="inline-flex items-center px-2 py-1 rounded ${coin.change >= 0 ? 'bg-green-900/30 text-green-400' : 'bg-red-900/30 text-red-400'}">
                            <span class="font-semibold">${coin.change >= 0 ? 'â–²' : 'â–¼'} ${Math.abs(coin.change).toFixed(2)}%</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <div class="text-gray-300">$${coin.marketCap}B</div>
                        <div class="text-xs text-gray-500">å¸‚å€¼</div>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <div class="text-gray-300">$${coin.volume}B</div>
                        <div class="text-xs text-gray-500">24hæˆäº¤é‡</div>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <div class="text-xs text-gray-400">
                            <div>é«˜: <span class="text-green-400">$${coin.high24h.toLocaleString()}</span></div>
                            <div>ä½: <span class="text-red-400">$${coin.low24h.toLocaleString()}</span></div>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function getGradient(symbol) {
            const gradients = {
                'BTC': 'from-orange-500 to-yellow-600',
                'ETH': 'from-blue-500 to-purple-600',
                'USDT': 'from-green-500 to-teal-600',
                'BNB': 'from-yellow-500 to-orange-600',
                'SOL': 'from-purple-500 to-pink-600',
                'XRP': 'from-blue-400 to-cyan-500',
                'ADA': 'from-blue-600 to-indigo-700'
            };
            return gradients[symbol] || 'from-gray-500 to-gray-600';
        }

        // è‡ªåŠ¨åˆ·æ–°ä»·æ ¼ï¼ˆæ¯30ç§’ï¼‰
        setInterval(() => {
            loadCryptoPrices();
        }, 30000);

        // æ¸²æŸ“æ–°é—»
        function renderNews(filter = '') {
            currentNewsFilter = filter;
            const filtered = filter ? newsData.filter(n => n.category === filter) : newsData;
            const sentimentColors = { bullish: 'bg-green-500', bearish: 'bg-red-500', neutral: 'bg-gray-500' };
            const sentimentText = { bullish: 'åˆ©å¤š ğŸ“ˆ', bearish: 'åˆ©ç©º ğŸ“‰', neutral: 'ä¸­æ€§' };
            const categoryText = { realtime: 'å®æ—¶æ–°é—»', important: 'é‡è¦äº‹ä»¶', breaking: 'çªå‘äº‹ä»¶' };
            
            document.getElementById('news-list').innerHTML = filtered.map(news => `
                <div class="bg-gray-800 rounded-lg p-6 hover:bg-gray-750 cursor-pointer">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <span class="px-3 py-1 bg-blue-600 rounded text-sm">${categoryText[news.category]}</span>
                            <span class="px-3 py-1 rounded text-sm ${sentimentColors[news.sentiment]}">${sentimentText[news.sentiment]}</span>
                        </div>
                        <span class="text-gray-400 text-sm">${news.time}</span>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">${news.title}</h3>
                    <p class="text-gray-300 mb-3">${news.content}</p>
                    <div class="flex items-center justify-between text-sm text-gray-400">
                        <span>æ¥æº: ${news.source}</span>
                        <span>ğŸ‘ï¸ ${news.views.toLocaleString()} é˜…è¯»</span>
                    </div>
                </div>
            `).join('');
        }

        function filterNews(category) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600');
                btn.classList.add('bg-gray-700');
            });
            event.target.classList.remove('bg-gray-700');
            event.target.classList.add('bg-blue-600');
            renderNews(category);
        }

        // æ¸²æŸ“ç»æµæ•°æ®æ—¥å†
        function renderEconomicCalendar() {
            const thisWeek = economicData.filter(d => ['12æœˆ7æ—¥', '12æœˆ8æ—¥', '12æœˆ9æ—¥'].includes(d.date));
            const nextWeek = economicData.filter(d => ['12æœˆ12æ—¥', '12æœˆ13æ—¥', '12æœˆ14æ—¥', '12æœˆ19æ—¥'].includes(d.date));
            
            document.getElementById('week-data').innerHTML = thisWeek.map(data => `
                <div class="bg-gray-700 rounded-lg p-4 ${data.status === 'published' ? 'border-l-4 border-green-500' : 'border-l-4 border-blue-500'}">
                    <div class="flex items-start justify-between mb-2">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="text-lg">${data.country}</span>
                                <span class="text-yellow-400">${'â­'.repeat(data.importance)}</span>
                            </div>
                            <div class="font-semibold text-white">${data.event}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-semibold ${data.status === 'published' ? 'text-green-400' : 'text-blue-400'}">
                                ${data.status === 'published' ? 'âœ“ å·²å…¬å¸ƒ' : 'å¾…å…¬å¸ƒ'}
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between text-sm text-gray-400 mt-3">
                        <span>ğŸ“… ${data.date} ${data.time}</span>
                    </div>
                    <div class="grid grid-cols-3 gap-2 mt-3 text-xs">
                        <div class="bg-gray-800 rounded p-2">
                            <div class="text-gray-500">å‰å€¼</div>
                            <div class="text-white font-semibold">${data.previous}</div>
                        </div>
                        <div class="bg-gray-800 rounded p-2">
                            <div class="text-gray-500">é¢„æµ‹</div>
                            <div class="text-yellow-400 font-semibold">${data.forecast}</div>
                        </div>
                        <div class="bg-gray-800 rounded p-2">
                            <div class="text-gray-500">å®é™…</div>
                            <div class="${data.actual ? 'text-green-400' : 'text-gray-600'} font-semibold">
                                ${data.actual || '--'}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('next-week-data').innerHTML = nextWeek.map(data => `
                <div class="bg-gray-700 rounded-lg p-4 border-l-4 border-purple-500">
                    <div class="flex items-start justify-between mb-2">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="text-lg">${data.country}</span>
                                <span class="text-yellow-400">${'â­'.repeat(data.importance)}</span>
                            </div>
                            <div class="font-semibold text-white">${data.event}</div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between text-sm text-gray-400 mt-3">
                        <span>ğŸ“… ${data.date} ${data.time}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mt-3 text-xs">
                        <div class="bg-gray-800 rounded p-2">
                            <div class="text-gray-500">å‰å€¼</div>
                            <div class="text-white font-semibold">${data.previous}</div>
                        </div>
                        <div class="bg-gray-800 rounded p-2">
                            <div class="text-gray-500">é¢„æµ‹</div>
                            <div class="text-yellow-400 font-semibold">${data.forecast}</div>
                        </div>
                    </div>
                </div>
            `).join('');

            // æ¸²æŸ“æœˆåº¦æ—¥å†
            const daysInMonth = 31;
            const calendarHTML = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].map(day => 
                `<div class="text-center font-semibold text-gray-400 py-2">${day}</div>`
            ).join('');
            
            let daysHTML = '';
            for (let i = 1; i <= daysInMonth; i++) {
                const hasEvent = economicData.some(d => d.date.includes(`${i}æ—¥`));
                const eventImportance = hasEvent ? Math.max(...economicData.filter(d => d.date.includes(`${i}æ—¥`)).map(d => d.importance)) : 0;
                daysHTML += `
                    <div class="aspect-square bg-gray-700 rounded p-2 text-center ${hasEvent ? 'border-2 border-yellow-500' : ''}">
                        <div class="text-sm font-semibold">${i}</div>
                        ${hasEvent ? `<div class="text-xs text-yellow-400 mt-1">${'â­'.repeat(eventImportance)}</div>` : ''}
                    </div>
                `;
            }
            
            document.getElementById('calendar-grid').innerHTML = calendarHTML + daysHTML;
        }

        // æ¸²æŸ“å¸–å­
        function renderPosts() {
            document.getElementById('posts-list').innerHTML = posts.map(post => `
                <div class="bg-gray-800 rounded-lg p-6">
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center font-bold">
                            ${post.user[0]}
                        </div>
                        <div class="ml-3">
                            <div class="font-semibold">${post.user}</div>
                            <div class="text-sm text-gray-400">${post.time}</div>
                        </div>
                    </div>
                    <p class="text-gray-200 mb-4">${post.content}</p>
                    <div class="flex items-center space-x-6 text-gray-400 border-t border-gray-700 pt-4">
                        <button class="flex items-center space-x-2 hover:text-blue-400">
                            <span>ğŸ‘</span><span>${post.likes}</span>
                        </button>
                        <button class="flex items-center space-x-2 hover:text-blue-400">
                            <span>ğŸ’¬</span><span>${post.comments}</span>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function createPost() {
            const content = document.getElementById('new-post').value;
            if (!content.trim()) return;
            posts.unshift({ id: Date.now(), user: 'æˆ‘', content, likes: 0, comments: 0, time: 'åˆšåˆš' });
            document.getElementById('new-post').value = '';
            renderPosts();
        }

        // å½“å‰é€‰æ‹©çš„å¥–é‡‘é‡‘é¢
        let selectedRewardAmount = 2;
        let isRewardPrediction = true;

        function toggleRewardType() {
            isRewardPrediction = !isRewardPrediction;
            const btn = document.getElementById('reward-toggle');
            const settings = document.getElementById('reward-settings');
            
            if (isRewardPrediction) {
                btn.textContent = 'ğŸ’° æœ‰å¥–é¢„æµ‹';
                btn.className = 'px-4 py-2 bg-green-600 rounded-lg text-sm font-semibold';
                settings.style.display = 'block';
            } else {
                btn.textContent = 'ğŸ¯ æ— å¥–é¢„æµ‹';
                btn.className = 'px-4 py-2 bg-gray-600 rounded-lg text-sm font-semibold';
                settings.style.display = 'none';
            }
        }

        function setRewardAmount(amount) {
            selectedRewardAmount = amount;
            document.querySelectorAll('.reward-btn').forEach((btn, i) => {
                if (i + 1 === amount) {
                    btn.className = 'reward-btn flex-1 px-4 py-2 bg-blue-600 rounded hover:bg-blue-700 transition';
                } else {
                    btn.className = 'reward-btn flex-1 px-4 py-2 bg-gray-600 rounded hover:bg-blue-600 transition';
                }
            });
        }

        // æ£€æŸ¥å¹¶é‡ç½®æ¯æ—¥é™åˆ¶
        function checkDailyReset() {
            const today = new Date().toDateString();
            if (userStats.lastResetDate !== today) {
                userStats.rewardPredictionsToday = 0;
                userStats.freePredictionsToday = 0;
                userStats.lastResetDate = today;
            }
        }

        // è®¡ç®—å¥–é‡‘æ± 
        function calculateRewardPool(totalVotes, rewardPerPerson) {
            const totalPool = totalVotes * rewardPerPerson;
            const creatorReward = totalPool * 0.01;  // 1%
            const platformFee = totalPool * 0.04;    // 4%
            const operationFee = totalPool * 0.05;   // 5%
            const winnerPool = totalPool * 0.90;     // 90%
            
            return {
                totalPool,
                creatorReward,
                platformFee,
                operationFee,
                winnerPool
            };
        }

        // æ¸²æŸ“é¢„æµ‹
        function renderPredictions() {
            document.getElementById('predictions-list').innerHTML = predictions.map(pred => {
                const total = pred.options.reduce((sum, opt) => sum + opt.votes, 0);
                const userVoted = pred.options.some(opt => opt.voted);
                
                // åŠ¨æ€è®¡ç®—å¥–é‡‘æ± 
                let poolInfo = { totalPool: 0, winnerPool: 0, creatorReward: 0, platformFee: 0 };
                if (pred.hasReward) {
                    poolInfo = calculateRewardPool(total, pred.rewardPerPerson);
                }
                
                return `
                    <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700 shadow-xl hover:shadow-2xl transition">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="text-2xl">${pred.hasReward ? 'ğŸ’°' : 'ğŸ¯'}</span>
                                    <h3 class="text-xl font-bold">${pred.title}</h3>
                                    ${!pred.hasReward ? '<span class="px-2 py-1 bg-gray-600 rounded text-xs">æ— å¥–é¢„æµ‹</span>' : ''}
                                </div>
                                <p class="text-gray-400 text-sm">${pred.desc}</p>
                            </div>
                            <div class="ml-4 text-right">
                                ${pred.hasReward ? `
                                    <div class="bg-gradient-to-r from-green-600 to-teal-600 rounded-lg p-3 mb-2 shadow-lg">
                                        <div class="text-xs text-green-100 mb-1">æ€»å¥–æ± </div>
                                        <div class="text-xl font-bold text-white">${poolInfo.totalPool.toFixed(1)} USDT</div>
                                        <div class="text-xs text-green-100 mt-1">${pred.rewardPerPerson} USDT/äºº Ã— ${total}äºº</div>
                                    </div>
                                    <div class="bg-gray-700 rounded p-2 text-xs space-y-1">
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">èƒœå‡ºå¥–åŠ±</span>
                                            <span class="text-green-400 font-semibold">${poolInfo.winnerPool.toFixed(1)}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">å‘èµ·å¥–åŠ±</span>
                                            <span class="text-yellow-400 font-semibold">${poolInfo.creatorReward.toFixed(2)}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">æ¿€åŠ±åŸºé‡‘</span>
                                            <span class="text-blue-400 font-semibold">${poolInfo.platformFee.toFixed(2)}</span>
                                        </div>
                                    </div>
                                ` : `
                                    <div class="bg-gray-700 rounded-lg p-3 mb-2">
                                        <div class="text-sm text-gray-400">æ— å¥–é‡‘æ± </div>
                                        <div class="text-xs text-gray-500 mt-1">çº¯é¢„æµ‹æŠ•ç¥¨</div>
                                    </div>
                                `}
                                <div class="text-xs text-gray-400 flex items-center justify-end space-x-1 mt-2">
                                    <span>â°</span>
                                    <span>${pred.deadline}</span>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-3 mb-4">
                            ${pred.options.map((opt, i) => {
                                const pct = total > 0 ? ((opt.votes / total) * 100).toFixed(1) : 0;
                                return `
                                    <div class="relative">
                                        <button 
                                            onclick="votePrediction(${pred.id}, ${i})" 
                                            class="w-full bg-gray-700 hover:bg-gray-600 rounded-lg p-4 transition ${opt.voted ? 'ring-2 ring-blue-500' : ''}"
                                        >
                                            <div class="flex items-center justify-between mb-2">
                                                <div class="flex items-center space-x-2">
                                                    ${opt.voted ? '<span class="text-blue-400">âœ“</span>' : ''}
                                                    <span class="font-semibold">${opt.text}</span>
                                                </div>
                                                <span class="text-blue-400 font-bold">${pct}%</span>
                                            </div>
                                            <div class="w-full bg-gray-600 rounded-full h-3 overflow-hidden">
                                                <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-3 rounded-full transition-all duration-500" style="width: ${pct}%"></div>
                                            </div>
                                            <div class="text-xs text-gray-400 mt-2 flex items-center justify-between">
                                                <span>${opt.votes} äººæŠ•ç¥¨</span>
                                                ${!isMember ? '<span class="text-yellow-400">ğŸ”’ ä¼šå‘˜å¯æŠ•ç¥¨</span>' : 
                                                  pred.hasReward ? `<span class="text-green-400">ğŸ’° ${pred.rewardPerPerson} USDT</span>` : 
                                                  '<span class="text-blue-400">å…è´¹æŠ•ç¥¨</span>'}
                                            </div>
                                        </button>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        ${userVoted ? `
                            <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-3 mb-4">
                                <div class="flex items-center justify-between text-sm">
                                    <div class="flex items-center space-x-2 text-green-400">
                                        <span>âœ“</span>
                                        <span>ä½ å·²æŠ•ç¥¨ï¼${pred.hasReward ? 'é¢„æµ‹å‡†ç¡®å°†è·å¾—å¥–åŠ±' : ''}</span>
                                    </div>
                                    ${pred.hasReward ? `<span class="text-yellow-400 font-semibold">å·²æŠ•å…¥ ${pred.rewardPerPerson} USDT</span>` : ''}
                                </div>
                            </div>
                        ` : ''}
                        <div class="flex items-center justify-between text-sm text-gray-400 border-t border-gray-700 pt-4">
                            <div class="flex items-center space-x-4">
                                <span>ğŸ‘¤ ${pred.creator}</span>
                                <span>ğŸ“Š ${total} äººå‚ä¸</span>
                            </div>
                            <button class="text-blue-400 hover:text-blue-300">æŸ¥çœ‹è¯¦æƒ… â†’</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function votePrediction(predId, optionIndex) {
            if (!isMember) {
                showMembershipModal();
                return;
            }
            
            const pred = predictions.find(p => p.id === predId);
            if (!pred) return;
            
            // æ£€æŸ¥æ˜¯å¦å·²æŠ•ç¥¨
            const alreadyVoted = pred.options.some(opt => opt.voted);
            
            if (pred.hasReward && !alreadyVoted) {
                const confirm = window.confirm(`ğŸ’° æŠ•ç¥¨éœ€è¦æ”¯ä»˜ ${pred.rewardPerPerson} USDT\n\né¢„æµ‹å‡†ç¡®å°†è·å¾—å¥–é‡‘åˆ†æˆï¼\nç¡®è®¤æŠ•ç¥¨å—ï¼Ÿ`);
                if (!confirm) return;
            }
            
            predictions = predictions.map(p => {
                if (p.id === predId) {
                    p.options.forEach((opt, i) => {
                        opt.voted = false;
                        if (opt.votes > 0 && opt.userVoted) opt.votes--;
                    });
                    p.options[optionIndex].votes++;
                    p.options[optionIndex].voted = true;
                    p.options[optionIndex].userVoted = true;
                    
                    // æ›´æ–°å¥–é‡‘æ± 
                    if (p.hasReward) {
                        const total = p.options.reduce((sum, opt) => sum + opt.votes, 0);
                        const poolInfo = calculateRewardPool(total, p.rewardPerPerson);
                        p.totalPool = poolInfo.totalPool;
                        p.creatorReward = poolInfo.creatorReward;
                        p.platformFee = poolInfo.platformFee;
                        p.winnerPool = poolInfo.winnerPool;
                        
                        // ç´¯è®¡å¹³å°æ¿€åŠ±åŸºé‡‘
                        userStats.platformFund += poolInfo.platformFee;
                    }
                }
                return p;
            });
            renderPredictions();
            
            if (pred.hasReward) {
                alert(`âœ… æŠ•ç¥¨æˆåŠŸï¼\n\nå·²æ”¯ä»˜ï¼š${pred.rewardPerPerson} USDT\né¢„æµ‹å‡†ç¡®å°†è·å¾—å¥–é‡‘ï¼`);
            }
        }

        function toggleCreatePrediction() {
            if (!isMember) {
                showMembershipModal();
                return;
            }
            document.getElementById('create-prediction').classList.toggle('hidden');
        }

        function createPrediction() {
            if (!isMember) {
                showMembershipModal();
                return;
            }
            
            // æ£€æŸ¥æ¯æ—¥é™åˆ¶
            checkDailyReset();
            
            if (isRewardPrediction) {
                if (userStats.rewardPredictionsToday >= 1) {
                    alert('âŒ æ¯å¤©åªèƒ½å‘èµ·1æ¬¡æœ‰å¥–é¢„æµ‹ï¼\n\nä½ ä»Šå¤©å·²ç»å‘èµ·è¿‡æœ‰å¥–é¢„æµ‹äº†ã€‚\næ˜å¤©å†æ¥å§ï¼');
                    return;
                }
            } else {
                if (userStats.freePredictionsToday >= 10) {
                    alert('âŒ æ¯å¤©æœ€å¤šå‘èµ·10æ¬¡æ— å¥–é¢„æµ‹ï¼\n\nä½ ä»Šå¤©å·²ç»è¾¾åˆ°ä¸Šé™äº†ã€‚\næ˜å¤©å†æ¥å§ï¼');
                    return;
                }
            }
            
            const title = document.getElementById('pred-title').value;
            const desc = document.getElementById('pred-desc').value;
            if (!title.trim()) {
                alert('è¯·è¾“å…¥é¢„æµ‹æ ‡é¢˜');
                return;
            }
            
            const newPrediction = {
                id: Date.now(),
                creator: 'æˆ‘',
                title,
                desc: desc || 'æ— æè¿°',
                options: [{text: 'æ˜¯', votes: 0, voted: false}, {text: 'å¦', votes: 0, voted: false}],
                hasReward: isRewardPrediction,
                rewardPerPerson: isRewardPrediction ? selectedRewardAmount : 0,
                totalPool: 0,
                creatorReward: 0,
                platformFee: 0,
                winnerPool: 0,
                deadline: '7å¤©',
                status: 'active'
            };
            
            predictions.unshift(newPrediction);
            
            // æ›´æ–°ç»Ÿè®¡
            if (isRewardPrediction) {
                userStats.rewardPredictionsToday++;
            } else {
                userStats.freePredictionsToday++;
            }
            
            document.getElementById('pred-title').value = '';
            document.getElementById('pred-desc').value = '';
            toggleCreatePrediction();
            renderPredictions();
            
            alert(`âœ… é¢„æµ‹åˆ›å»ºæˆåŠŸï¼\n\nç±»å‹ï¼š${isRewardPrediction ? 'æœ‰å¥–é¢„æµ‹' : 'æ— å¥–é¢„æµ‹'}\n${isRewardPrediction ? `æ¯äººæŠ•æ³¨ï¼š${selectedRewardAmount} USDT` : ''}\n\nä»Šæ—¥å‰©ä½™ï¼š\nâ€¢ æœ‰å¥–é¢„æµ‹ï¼š${1 - userStats.rewardPredictionsToday}æ¬¡\nâ€¢ æ— å¥–é¢„æµ‹ï¼š${10 - userStats.freePredictionsToday}æ¬¡`);
        }

        function showMembershipModal() {
            document.getElementById('membership-modal').style.display = 'flex';
        }

        function closeMembershipModal() {
            document.getElementById('membership-modal').style.display = 'none';
        }

        function becomeMember() {
            // æ¨¡æ‹Ÿæ”¯ä»˜
            alert('æ¨¡æ‹Ÿæ”¯ä»˜ 1 USDT æˆåŠŸï¼\n\næ­å–œä½ æˆä¸ºä¼šå‘˜ï¼ğŸ‰');
            isMember = true;
            closeMembershipModal();
            renderPredictions();
            // æ›´æ–°ä¼šå‘˜çŠ¶æ€æ˜¾ç¤º
            document.getElementById('member-status').innerHTML = '<span class="px-4 py-2 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg font-semibold">ğŸ‘‘ ä¼šå‘˜</span>';
            document.getElementById('member-notice').style.display = 'none';
        }

        // æ›´æ–°å¹³å°åŸºé‡‘æ˜¾ç¤º
        function updatePlatformFund() {
            document.getElementById('platform-fund').textContent = userStats.platformFund.toFixed(2) + ' USDT';
        }

        // åˆå§‹åŒ–
        loadCryptoPrices();  // åŠ è½½çœŸå®ä»·æ ¼æ•°æ®
        loadNews();          // åŠ è½½çœŸå®æ–°é—»æ•°æ®
        renderPosts();
        renderPredictions();
        renderEconomicCalendar();
        updatePlatformFund();
        showPage('market');
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('membership-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeMembershipModal();
            }
        });
    </script>
</body>
</html>
